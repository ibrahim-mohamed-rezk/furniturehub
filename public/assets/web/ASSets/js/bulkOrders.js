const clickInput = (id) => {
    document.getElementById(`file-${id}`).click();
};

let uploadedFiles = [];

const uploadeImg = (event, id) => {
    const file = event.target.files[0];
    if (file) {
        uploadedFiles.push(file);

        const reader = new FileReader();
        reader.onloadend = () => {
            const uploadedImg = [reader.result];

            const imgInput = document.createElement("div");
            imgInput.classList.add("imgInput");

            uploadedImg.forEach((link, index) => {
                const img = document.createElement("img");
                img.src = link;
                img.classList.add("img");

                const deleteBtn = document.createElement("button");
                deleteBtn.innerHTML = `<svg width="34" height="34" viewBox="0 0 34 34" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path opacity="0.3" d="M23.65 0H9.68333C4.33538 0 0 4.33538 0 9.68333V23.65C0 28.998 4.33538 33.3333 9.68333 33.3333H23.65C28.998 33.3333 33.3333 28.998 33.3333 23.65V9.68333C33.3333 4.33538 28.998 0 23.65 0Z" fill="#6D6D6D"/>
                                    <path d="M19.0185 16.6668L23.7352 11.9502C23.9096 11.8007 24.0513 11.6169 24.1514 11.4101C24.2514 11.2033 24.3076 10.9781 24.3165 10.7486C24.3254 10.519 24.2867 10.2902 24.2029 10.0763C24.1191 9.8624 23.992 9.66816 23.8296 9.50573C23.6672 9.34331 23.4729 9.21621 23.259 9.13242C23.0452 9.04863 22.8163 9.00995 22.5868 9.01882C22.3572 9.02769 22.132 9.0839 21.9252 9.18394C21.7185 9.28398 21.5346 9.42568 21.3852 9.60015L16.6685 14.3168L11.9518 9.60015C11.633 9.32711 11.2229 9.18443 10.8034 9.20063C10.384 9.21683 9.98606 9.39072 9.68924 9.68755C9.39241 9.98437 9.21852 10.3823 9.20232 10.8017C9.18612 11.2212 9.3288 11.6313 9.60184 11.9502L14.3185 16.6668L9.60184 21.3835C9.29142 21.6958 9.11719 22.1182 9.11719 22.5585C9.11719 22.9988 9.29142 23.4212 9.60184 23.7335C9.91411 24.0439 10.3365 24.2181 10.7768 24.2181C11.2172 24.2181 11.6396 24.0439 11.9518 23.7335L16.6685 19.0168L21.3852 23.7335C21.6974 24.0439 22.1199 24.2181 22.5602 24.2181C23.0005 24.2181 23.4229 24.0439 23.7352 23.7335C24.0456 23.4212 24.2198 22.9988 24.2198 22.5585C24.2198 22.1182 24.0456 21.6958 23.7352 21.3835L19.0185 16.6668Z" fill="#6D6D6D"/>
                                  </svg>`;
                deleteBtn.classList.add("delete-btn");
                deleteBtn.onclick = () => {
                    deleteFile(index, imgInput);
                };

                imgInput.appendChild(img);
                imgInput.appendChild(deleteBtn);
            });

            document.getElementById(`productImagesInputs-${id}`).prepend(imgInput);
        };

        reader.readAsDataURL(file);
        updateInputFiles(event);
    }
};

const deleteFile = (index, imgInput) => {
    uploadedFiles.splice(index, 1);
    imgInput.remove();
    const inputEvent = new Event("input", { bubbles: true });
    const fileInput = document.querySelector('input[type="file"]');
    updateInputFiles(inputEvent, fileInput);
};

const updateInputFiles = (event, fileInput = event.target) => {
    const dataTransfer = new DataTransfer();
    uploadedFiles.forEach((file) => dataTransfer.items.add(file));
    fileInput.files = dataTransfer.files;
};

document.addEventListener("DOMContentLoaded", function () {
    const productsContainer = document.querySelector(".products");
    const addProductBtn = document.getElementById("addProductBtn");
    let index = 1;

    // Add product event listener
    addProductBtn.addEventListener("click", function () {
        const newProduct = document.createElement("div");
        newProduct.classList.add("product");
        newProduct.innerHTML = `
                            <span class="proTitle">صورةالمنتج * :</span>
                            <div class="product-images">
                                <div class="product-images-head">
                                    <div class="deletProduct">
                                        <div class="icon">
                                            <svg width="36" height="36" viewBox="0 0 36 36" fill="none"
                                                xmlns="http://www.w3.org/2000/svg">
                                                <path d="M7 7H28V32H7V7Z" fill="white" />
                                                <path
                                                    d="M25.29 0H10.8C7.93566 0 5.18864 1.13785 3.16325 3.16325C1.13785 5.18864 0 7.93566 0 10.8V25.38C0.0472237 28.213 1.20589 30.914 3.22619 32.9007C5.24649 34.8873 7.96658 36.0004 10.8 36H25.38C28.1975 35.9531 30.8851 34.8069 32.8693 32.806C34.8534 30.805 35.9769 28.1078 36 25.29V10.8C36.0001 7.95119 34.8746 5.21772 32.8686 3.19489C30.8627 1.17207 28.1387 0.0237401 25.29 0ZM24.48 25.974C24.3913 26.5797 24.0806 27.1307 23.6081 27.5199C23.1357 27.9092 22.5354 28.1088 21.924 28.08H14.274C13.6536 28.1228 13.0399 27.9295 12.5559 27.539C12.0719 27.1484 11.7533 26.5895 11.664 25.974L10.926 16.794C10.9281 16.6521 10.9591 16.5122 11.0171 16.3827C11.0751 16.2533 11.1589 16.137 11.2633 16.0409C11.3677 15.9449 11.4907 15.8712 11.6245 15.8243C11.7584 15.7773 11.9005 15.7582 12.042 15.768H23.958C24.0995 15.7582 24.2416 15.7773 24.3755 15.8243C24.5093 15.8712 24.6323 15.9449 24.7367 16.0409C24.8411 16.137 24.9249 16.2533 24.9829 16.3827C25.0409 16.5122 25.0719 16.6521 25.074 16.794L24.48 25.974ZM26.082 13.698C20.7077 12.9536 15.2563 12.9536 9.882 13.698C9.70705 13.7291 9.52768 13.7253 9.3542 13.6869C9.18071 13.6484 9.01651 13.5762 8.87102 13.4741C8.72553 13.3721 8.60161 13.2424 8.50637 13.0924C8.41113 12.9424 8.34643 12.7751 8.316 12.6C8.28522 12.4248 8.28984 12.2452 8.32959 12.0719C8.36933 11.8985 8.4434 11.7348 8.54742 11.5906C8.65144 11.4463 8.7833 11.3243 8.93523 11.2318C9.08715 11.1393 9.25606 11.0782 9.432 11.052C10.9818 10.8034 12.5442 10.6411 14.112 10.566L14.4 9C14.4406 8.53623 14.6432 8.10159 14.9724 7.7724C15.3016 7.44322 15.7362 7.24055 16.2 7.2H19.8C20.2638 7.24055 20.6984 7.44322 21.0276 7.7724C21.3568 8.10159 21.5594 8.53623 21.6 9L21.834 10.458C23.328 10.548 24.894 10.692 26.496 10.926C26.8503 10.9836 27.1678 11.1782 27.3799 11.4678C27.5921 11.7574 27.6819 12.1188 27.63 12.474C27.6038 12.7991 27.4592 13.1033 27.2236 13.3289C26.9881 13.5545 26.6779 13.6858 26.352 13.698H26.082Z"
                                                    fill="#F1416C" />
                                            </svg>
                                        </div>
                                        <div class="info">
                                            <h3>صورةالمنتج * :</h3>
                                            <span>أضف صور للمنتج اللذي تريد طلبة</span>
                                        </div>
                                    </div>
                                    <div class="productInputs">
                                        <div class="dimensions">
                                            <div class="inputContainer">
                                                <div class="inputIconContainer">
                                                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none"
                                                        xmlns="http://www.w3.org/2000/svg">
                                                        <path fill-rule="evenodd" clip-rule="evenodd"
                                                            d="M10.75 17.2787L12.34 15.6587C12.4092 15.587 12.4919 15.5298 12.5834 15.4904C12.6749 15.451 12.7733 15.4303 12.8729 15.4293C12.9725 15.4284 13.0713 15.4473 13.1636 15.485C13.2558 15.5227 13.3396 15.5783 13.41 15.6487C13.5505 15.7894 13.6294 15.98 13.6294 16.1787C13.6294 16.3775 13.5505 16.5681 13.41 16.7087L10.47 19.7087C10.3268 19.8528 10.1331 19.9353 9.93004 19.9387C9.72998 19.9348 9.53954 19.8522 9.40004 19.7087L6.46004 16.7087C6.32861 16.5654 6.25802 16.3765 6.26316 16.1821C6.2683 15.9877 6.34877 15.8028 6.48759 15.6666C6.62641 15.5304 6.81273 15.4534 7.00722 15.4519C7.20171 15.4505 7.38917 15.5246 7.53004 15.6587L9.23004 17.4287L9.20765 10.7573H2.61001L4.28001 12.3573C4.38827 12.4616 4.46267 12.5961 4.49358 12.7432C4.52448 12.8903 4.51046 13.0433 4.45333 13.1824C4.3962 13.3215 4.29859 13.4401 4.17318 13.523C4.04777 13.6059 3.90034 13.6492 3.75001 13.6473C3.65281 13.6488 3.55638 13.63 3.46685 13.5921C3.37732 13.5542 3.29666 13.4981 3.23001 13.4273L0.320013 10.5773C0.222155 10.513 0.141726 10.4255 0.0858936 10.3225C0.0300598 10.2196 0.000556946 10.1044 1.33514e-05 9.98732H0.0500126C0.0494957 9.88638 0.0696316 9.78641 0.109186 9.69354C0.148739 9.60068 0.206875 9.51688 0.280014 9.44732L3.28001 6.50732C3.34352 6.41476 3.42701 6.33763 3.5243 6.28163C3.62159 6.22563 3.73021 6.19218 3.84215 6.18376C3.9541 6.17533 4.0665 6.19214 4.17108 6.23295C4.27566 6.27376 4.36974 6.33752 4.44639 6.41954C4.52304 6.50155 4.5803 6.59973 4.61395 6.70683C4.6476 6.81392 4.65678 6.92721 4.64081 7.03832C4.62485 7.14944 4.58414 7.25555 4.52169 7.34884C4.45925 7.44213 4.37666 7.52021 4.28001 7.57732L2.55001 9.19732H9.20241L9.18004 2.52873L7.48004 4.26873C7.33941 4.40918 7.14879 4.48807 6.95004 4.48807C6.75129 4.48807 6.56066 4.40918 6.42004 4.26873C6.27959 4.1281 6.2007 3.93748 6.2007 3.73873C6.2007 3.53998 6.27959 3.34936 6.42004 3.20873L9.36004 0.20873C9.50587 0.0745038 9.69683 0 9.89504 0C10.0932 0 10.2842 0.0745038 10.43 0.20873L13.37 3.20873C13.5105 3.34936 13.5894 3.53998 13.5894 3.73873C13.5894 3.93748 13.5105 4.1281 13.37 4.26873C13.2267 4.40396 13.0371 4.47912 12.84 4.47873C12.7414 4.47976 12.6436 4.4608 12.5525 4.42299C12.4614 4.38518 12.3789 4.3293 12.31 4.25873L10.7 2.61873L10.7225 9.19732H17.36L15.67 7.53732C15.5296 7.39669 15.4507 7.20607 15.4507 7.00732C15.4507 6.80857 15.5296 6.61795 15.67 6.47732C15.8106 6.33687 16.0013 6.25798 16.2 6.25798C16.3988 6.25798 16.5894 6.33687 16.73 6.47732L19.73 9.46732C19.8032 9.53688 19.8613 9.62068 19.9008 9.71354C19.9404 9.80641 19.9605 9.90638 19.96 10.0073C19.9604 10.1068 19.9401 10.2052 19.9005 10.2964C19.8609 10.3876 19.8029 10.4696 19.73 10.5373L16.73 13.4773C16.6606 13.5502 16.5773 13.6084 16.4849 13.6484C16.3926 13.6884 16.2931 13.7094 16.1925 13.7102C16.0919 13.7109 15.9921 13.6914 15.8992 13.6528C15.8062 13.6142 15.722 13.5573 15.6515 13.4855C15.581 13.4137 15.5257 13.3284 15.4889 13.2347C15.452 13.1411 15.4344 13.041 15.4371 12.9404C15.4397 12.8398 15.4626 12.7407 15.5044 12.6491C15.5461 12.5576 15.6058 12.4753 15.68 12.4073L17.36 10.7573H10.7278L10.75 17.2787Z"
                                                            fill="black" />
                                                    </svg>
                                                </div>
                                                <input type="text" placeholder="ادخل الاسم بالكامل" />
                                            </div>
                                        </div>
                                        <div class="quantity">
                                            <div class="inputContainer">
                                                <select>
                                                    <option>الكمية</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div id="productImagesInputs-${index}" class="product-images-inputs">
                                    <div onclick="clickInput(${index})" class="imgInput">
                                        <input style="display: none" onchange="uploadeImg(event, ${index})" id="file-${index}" type="file"
                                            name="file" />
                                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none"
                                            xmlns="http://www.w3.org/2000/svg">
                                            <path opacity="0.3"
                                                d="M9 11H5C4.73478 11 4.48043 10.8946 4.29289 10.7071C4.10536 10.5196 4 10.2652 4 10C4 9.73478 4.10536 9.48043 4.29289 9.29289C4.48043 9.10536 4.73478 9 5 9H9V11ZM15 9H11V11H15C15.2652 11 15.5196 10.8946 15.7071 10.7071C15.8946 10.5196 16 10.2652 16 10C16 9.73478 15.8946 9.48043 15.7071 9.29289C15.5196 9.10536 15.2652 9 15 9Z"
                                                fill="#707070" />
                                            <path opacity="0.3"
                                                d="M14.19 0H5.81C2.60123 0 0 2.60123 0 5.81V14.19C0 17.3988 2.60123 20 5.81 20H14.19C17.3988 20 20 17.3988 20 14.19V5.81C20 2.60123 17.3988 0 14.19 0Z"
                                                fill="#707070" />
                                            <path
                                                d="M15 9H11V5C11 4.73478 10.8946 4.48043 10.7071 4.29289C10.5196 4.10536 10.2652 4 10 4C9.73478 4 9.48043 4.10536 9.29289 4.29289C9.10536 4.48043 9 4.73478 9 5V9H5C4.73478 9 4.48043 9.10536 4.29289 9.29289C4.10536 9.48043 4 9.73478 4 10C4 10.2652 4.10536 10.5196 4.29289 10.7071C4.48043 10.8946 4.73478 11 5 11H9V15C9 15.2652 9.10536 15.5196 9.29289 15.7071C9.48043 15.8946 9.73478 16 10 16C10.2652 16 10.5196 15.8946 10.7071 15.7071C10.8946 15.5196 11 15.2652 11 15V11H15C15.2652 11 15.5196 10.8946 15.7071 10.7071C15.8946 10.5196 16 10.2652 16 10C16 9.73478 15.8946 9.48043 15.7071 9.29289C15.5196 9.10536 15.2652 9 15 9Z"
                                                fill="#707070" />
                                        </svg>
                                        <span>Add File</span>
                                    </div>
                                </div>
                            </div>
                            <div style="display: none" class="bottomBroductInputs">
                                <div class="dimensions">
                                    <div class="inputContainer">
                                        <div class="inputIconContainer">
                                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none"
                                                xmlns="http://www.w3.org/2000/svg">
                                                <path fill-rule="evenodd" clip-rule="evenodd"
                                                    d="M10.75 17.2787L12.34 15.6587C12.4092 15.587 12.4919 15.5298 12.5834 15.4904C12.6749 15.451 12.7733 15.4303 12.8729 15.4293C12.9725 15.4284 13.0713 15.4473 13.1636 15.485C13.2558 15.5227 13.3396 15.5783 13.41 15.6487C13.5505 15.7894 13.6294 15.98 13.6294 16.1787C13.6294 16.3775 13.5505 16.5681 13.41 16.7087L10.47 19.7087C10.3268 19.8528 10.1331 19.9353 9.93004 19.9387C9.72998 19.9348 9.53954 19.8522 9.40004 19.7087L6.46004 16.7087C6.32861 16.5654 6.25802 16.3765 6.26316 16.1821C6.2683 15.9877 6.34877 15.8028 6.48759 15.6666C6.62641 15.5304 6.81273 15.4534 7.00722 15.4519C7.20171 15.4505 7.38917 15.5246 7.53004 15.6587L9.23004 17.4287L9.20765 10.7573H2.61001L4.28001 12.3573C4.38827 12.4616 4.46267 12.5961 4.49358 12.7432C4.52448 12.8903 4.51046 13.0433 4.45333 13.1824C4.3962 13.3215 4.29859 13.4401 4.17318 13.523C4.04777 13.6059 3.90034 13.6492 3.75001 13.6473C3.65281 13.6488 3.55638 13.63 3.46685 13.5921C3.37732 13.5542 3.29666 13.4981 3.23001 13.4273L0.320013 10.5773C0.222155 10.513 0.141726 10.4255 0.0858936 10.3225C0.0300598 10.2196 0.000556946 10.1044 1.33514e-05 9.98732H0.0500126C0.0494957 9.88638 0.0696316 9.78641 0.109186 9.69354C0.148739 9.60068 0.206875 9.51688 0.280014 9.44732L3.28001 6.50732C3.34352 6.41476 3.42701 6.33763 3.5243 6.28163C3.62159 6.22563 3.73021 6.19218 3.84215 6.18376C3.9541 6.17533 4.0665 6.19214 4.17108 6.23295C4.27566 6.27376 4.36974 6.33752 4.44639 6.41954C4.52304 6.50155 4.5803 6.59973 4.61395 6.70683C4.6476 6.81392 4.65678 6.92721 4.64081 7.03832C4.62485 7.14944 4.58414 7.25555 4.52169 7.34884C4.45925 7.44213 4.37666 7.52021 4.28001 7.57732L2.55001 9.19732H9.20241L9.18004 2.52873L7.48004 4.26873C7.33941 4.40918 7.14879 4.48807 6.95004 4.48807C6.75129 4.48807 6.56066 4.40918 6.42004 4.26873C6.27959 4.1281 6.2007 3.93748 6.2007 3.73873C6.2007 3.53998 6.27959 3.34936 6.42004 3.20873L9.36004 0.20873C9.50587 0.0745038 9.69683 0 9.89504 0C10.0932 0 10.2842 0.0745038 10.43 0.20873L13.37 3.20873C13.5105 3.34936 13.5894 3.53998 13.5894 3.73873C13.5894 3.93748 13.5105 4.1281 13.37 4.26873C13.2267 4.40396 13.0371 4.47912 12.84 4.47873C12.7414 4.47976 12.6436 4.4608 12.5525 4.42299C12.4614 4.38518 12.3789 4.3293 12.31 4.25873L10.7 2.61873L10.7225 9.19732H17.36L15.67 7.53732C15.5296 7.39669 15.4507 7.20607 15.4507 7.00732C15.4507 6.80857 15.5296 6.61795 15.67 6.47732C15.8106 6.33687 16.0013 6.25798 16.2 6.25798C16.3988 6.25798 16.5894 6.33687 16.73 6.47732L19.73 9.46732C19.8032 9.53688 19.8613 9.62068 19.9008 9.71354C19.9404 9.80641 19.9605 9.90638 19.96 10.0073C19.9604 10.1068 19.9401 10.2052 19.9005 10.2964C19.8609 10.3876 19.8029 10.4696 19.73 10.5373L16.73 13.4773C16.6606 13.5502 16.5773 13.6084 16.4849 13.6484C16.3926 13.6884 16.2931 13.7094 16.1925 13.7102C16.0919 13.7109 15.9921 13.6914 15.8992 13.6528C15.8062 13.6142 15.722 13.5573 15.6515 13.4855C15.581 13.4137 15.5257 13.3284 15.4889 13.2347C15.452 13.1411 15.4344 13.041 15.4371 12.9404C15.4397 12.8398 15.4626 12.7407 15.5044 12.6491C15.5461 12.5576 15.6058 12.4753 15.68 12.4073L17.36 10.7573H10.7278L10.75 17.2787Z"
                                                    fill="black" />
                                            </svg>
                                        </div>
                                        <input type="text" placeholder="ادخل الاسم بالكامل" />
                                    </div>
                                </div>
                                <div class="quantity">
                                    <div class="inputContainer">
                                        <select>
                                            <option>الكمية</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        `;
        // Insert the new product at the top of the container
        if (productsContainer.firstChild) {
            productsContainer.insertBefore(newProduct, productsContainer.firstChild);
        } else {
            productsContainer.appendChild(newProduct);
        }

        // Add event listener to the delete icon of the newly created product
        addDeleteListener(newProduct);
    });

    // Function to add delete functionality to a product
    function addDeleteListener(product) {
        const deleteIcon = product.querySelector(".icon");
        deleteIcon.addEventListener("click", function () {
            product.remove();
        });
    }

    document.querySelectorAll(".product").forEach((product) => {
        addDeleteListener(product);
    });
});